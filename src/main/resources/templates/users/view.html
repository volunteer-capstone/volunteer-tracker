<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
	<th:block th:replace="fragments/header :: my-header(${user.getUsername()+'''s Profile'})" />
</head>
<body>
<th:block th:replace="fragments/navbar :: bulma-navbar" />

<div class="container">
	<div class="content">
		<h3 th:if="${user.id} == ${userId}">This is your profile: &emsp;<a class="button is-info" th:href="@{/profile/edit}">Edit</a></h3>
		<h3 th:unless="${user.id} == ${userId}" th:text="'This is '+${user.username}+'\'s profile: '"></h3>
		<div class="columns is-mobile">
			<div class="column is-half">
				<div class="content is-flex is-horizontal-center">
					<th:block th:if="${user.photo} == null">
						<img th:src="@{/img/profilePlaceholder.png}" alt="profile photo" width="250rem" height="200rem" />
					</th:block>
					<th:block th:unless="${user.photo} == null">
						<img th:src="@{${user.photo}}" alt="profile photo" width="250rem" height="200rem"/>
					</th:block>
				</div>
				<div class="content">
					<p>Name: 						<span th:text="${user.firstName}"></span> <span th:text="${user.lastName}"></span></p>
					<p>Username: 					<span th:text="${user.username}"></span></p>
					<p>Email: 						<a th:text="${user.email}"></a></p>
					<p>Phone Number: 				<a th:text="${user.phoneNumber}"></a></p>
					<p>Number of Hours Volunteered: <span th:text="${user.getHours()}"></span></p>
					<p>Number of Hours Planned:		<span th:text="${user.plannedHours()}"></span></p>
					<p>Bio: <span th:text="${user.bio}"></span></p>
					<p th:if="${user.organizer}"><strong>Organizer</strong></p>

					<th:block sec:authorize="isAuthenticated()">
						<th:block th:if="(${user.id} != ${userId}) and (${curUser.organizer})"><p>Would you like to make this user an Organizer? </p>
							<form th:action="@{/profile/organizer/{id}(id=${user.id})}" th:method="post">
								<div class="field">
									<div class="control">
										<button class="button">Click Here</button>
									</div>
								</div>
							</form>
						</th:block>
					</th:block>
				</div>
			</div>
			<div class="column">
				<div class="tabs is-toggle">
					<ul>
						<li class="tab has-background-white"><a class="pastEvents">Past Volunteered Events</a></li>
						<li class="tab is-active has-background-white"><a class="plannedEvents">Upcoming Volunteered Events</a></li>
					</ul>
				</div>
				<div class="tabs is-toggle">
					<ul>
						<li class="tab has-background-white"><a th:if="${user.organizer}" class="pastEventsCreated">Created Past Events</a></li>
						<li class="tab has-background-white"><a th:if="${user.organizer}" class="plannedEventsCreated">Created Upcoming Events</a></li>
					</ul>
				</div>
				<hr/>
				<div class="content">
					<h4>Events:</h4>
					<div class="columns is-mobile is-multiple">

						<div th:each="event: ${user.getUserEvents()}" class="pastEventDiv" style="display: none">
							<div class="column">
								<div th:if="*{event.getStart().before(execInfo.now)}">
									<br/>
									<h5>This Event has ended</h5>
									<h6 th:text="*{event.title}"></h6>
									<th:block th:each="pos: ${user.getUserPositionsByEventId(event.getId())}">
										<h6>Position has ended</h6>
										<p th:text="'Position: ' + *{pos.title}"></p>
										<p th:text="'Start: ' + *{#dates.format(pos.start, 'MMM-dd-yyyy HH:mm')} + ' - ' + *{#dates.format(pos.end, 'HH:mm')}"></p>
									</th:block>
									<div class="field">
										<div class="control">
											<a th:href="@{/events/{id}(id=${event.id})}" class="button is-small is-info">View Event</a>
										</div>
									</div>
									<hr/>
								</div>
							</div>
						</div>
					</div>

					<div th:each="event: ${user.getUserEvents()}" class="plannedEventDiv">
						<div class="column">
							<div th:if="*{event.getStart().after(execInfo.now)}">
								<br/>
								<h6 th:text="*{event.title}"></h6>
								<th:block th:each="pos: ${user.getUserPositionsByEventId(event.getId())}">
									<p th:text="'Position: ' + *{pos.title}"></p>
									<p th:text="'Start: ' + *{#dates.format(pos.start, 'MMM-dd-yyyy HH:mm')} + ' - ' + *{#dates.format(pos.end, 'HH:mm')}"></p>
									<div class="field">
										<div class="control">
											<a class="button is-small is-success" th:href="@{/events/positions/{id}/volunteer/remove(id=${pos.getId()})}">Unregister for Event</a>
										</div>
									</div>
								</th:block>
								<div class="field">
									<div class="control">
										<a th:href="@{/events/{id}(id=${event.id})}" class="button is-small is-info">View Event</a>
									</div>
								</div>
								<hr/>
							</div>
						</div>
					</div>

					<div th:each="event: ${user.getEvents()}" class="pastCreatedEventDiv" style="display: none">
						<div class="column">
							<div th:if="*{event.getStart().before(execInfo.now)}">
								<br/>
								<h5>This Event has ended</h5>
								<h6 th:text="*{event.title}"></h6>
								<p th:text="'Start: ' + *{#dates.format(event.start, 'MMM-dd-yyyy HH:mm')} + ' - ' + *{#dates.format(event.stop, 'HH:mm')}"></p>
								<div class="field">
									<div class="control">
										<a th:href="@{/events/{id}(id=${event.id})}" class="button is-small is-info">View Event</a>
									</div>
								</div>
								<th:block th:if="(${user.id} == ${userId}) and (${user.organizer} == true)">
									<div class="field is-grouped">
										<div class="control" >
											<a class="open-modal button is-small is-success">Text Position Volunteers</a>
											<div class="modal">
												<div class="modal-background close"></div>
												<div class="modal-card">
													<header class="modal-card-head">
														<p class="modal-card-title">Write your message</p>
														<button class="close delete is-large" aria-label="close"></button>
													</header>
													<section class="modal-card-body">
<!--														<form th:action="@{/text/position/{id}(id = ${position.id})}" th:method="post">-->
<!--															<div class="field">-->
<!--																<label class="label">Message</label>-->
<!--																<div class="control">-->
<!--																	<textarea class="textarea" name="body" cols="30" rows="10"></textarea>-->
<!--																</div>-->
<!--															</div>-->
<!--															<button class="button" type="submit">Send SMS</button>-->
<!--														</form>-->
													</section>
													<footer class="modal-card-foot">
														<button class="close button">Cancel
															<span class="icon">
                                                				<i class="fas fa-backspace"></i>
                                            				</span>
														</button>
													</footer>
												</div>
											</div>
										</div>
										<div class="control">
											<a th:href="@{/events/approve/{id}(id=${event.id})}" class="button is-small is-info">Approve hours</a>
										</div>
									</div>
								</th:block>
								<hr/>
							</div>
						</div>
					</div>

					<div th:each="event: ${user.getEvents()}" class="plannedCreatedEventDiv" style="display: none">
						<div class="column">
							<div th:if="*{event.getStart().after(execInfo.now)}">
								<br/>
								<h5 th:text="*{event.title}"></h5>
								<p th:text="'Start: ' + *{#dates.format(event.start, 'MMM-dd-yyyy HH:mm')} + ' - ' + *{#dates.format(event.stop, 'HH:mm')}"></p>
								<div class="field">
									<div class="control">
										<a th:href="@{/events/{id}(id=${event.id})}" class="button is-small is-info">View Event</a>
									</div>
								</div>
								<th:block th:if="(${user.id} == ${userId}) and (${user.organizer} == true)">
									<div class="field">
										<div class="control">
											<a class="open-modal button is-small is-success">Text Position Volunteers</a>
											<div class="modal">
												<div class="modal-background close"></div>
												<div class="modal-card">
													<header class="modal-card-head">
														<p class="modal-card-title">Write your message</p>
														<button class="close delete is-large" aria-label="close"></button>
													</header>
													<section class="modal-card-body">
<!--														<form th:action="@{/text/position/{id}(id = ${position.id})}" th:method="post">-->
<!--															<div class="field">-->
<!--																<label class="label">Message</label>-->
<!--																<div class="control">-->
<!--																	<textarea class="textarea" name="body" cols="30" rows="10"></textarea>-->
<!--																</div>-->
<!--															</div>-->
<!--															<button class="button" type="submit">Send SMS</button>-->
<!--														</form>-->
													</section>
													<footer class="modal-card-foot">
														<button class="close button">Cancel
															<span class="icon">
                                                				<i class="fas fa-backspace"></i>
                                            				</span>
														</button>
													</footer>
												</div>
											</div>
										</div>
									</div>
								</th:block>
								<hr/>
							</div>
						</div>
					</div>
			</div>
		</div>
	</div>
	</div>
</div>

<!--<div class = "footerSpace"><th:block th:replace="fragments/footer :: footer" /></div>-->
</body>
<script th:src="@{/js/profilejs.js}"></script>
<script th:src="@{/js/bulmaModalJs.js}"></script>
</html>
